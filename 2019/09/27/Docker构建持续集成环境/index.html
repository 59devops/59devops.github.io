<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.4.0">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg?v=7.4.0" color="#222">
  <link rel="alternate" href="/atom.xml" title="59Devops" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1、CI/CD介绍CI/CD是一个持续的闭环的流程。">
<meta name="keywords" content="Docker,CI&amp;CD">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker构建持续集成环境">
<meta property="og:url" content="http://yoursite.com/2019/09/27/Docker构建持续集成环境/index.html">
<meta property="og:site_name" content="59Devops">
<meta property="og:description" content="1、CI/CD介绍CI/CD是一个持续的闭环的流程。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190626160504.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190627094657.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629160945.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629161138.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630212517.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215243.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215318.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215331.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215555.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215733.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215828.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630215855.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629163516.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629160309.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629160423.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629161631.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190629161741.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630124544.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630124656.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630125049.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630125137.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630125555.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630125837.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630130047.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630131002.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630131541.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630131704.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630131803.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630132104.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630132326.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630143110.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630144948.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630133041.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630133217.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630134051.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630134258.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630143336.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630143506.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630211739.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630211617.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630213434.png">
<meta property="og:image" content="http://static.staryjie.com/static/images/20190630211855.png">
<meta property="og:updated_time" content="2019-09-27T05:47:51.234Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker构建持续集成环境">
<meta name="twitter:description" content="1、CI/CD介绍CI/CD是一个持续的闭环的流程。">
<meta name="twitter:image" content="http://static.staryjie.com/static/images/20190626160504.png">
  <link rel="canonical" href="http://yoursite.com/2019/09/27/Docker构建持续集成环境/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Docker构建持续集成环境 | 59Devops</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">59Devops</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">一个运维小菜鸡的个人博客网站。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a class="book-mark-link book-mark-link-fixed" href="#"></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/27/Docker构建持续集成环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="StaryJie">
      <meta itemprop="description" content="记录学习、工作和生活中遇到的各种问题。">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="59Devops">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Docker构建持续集成环境

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-27 13:43:13 / 修改时间：13:47:51" itemprop="dateCreated datePublished" datetime="2019-09-27T13:43:13+08:00">2019-09-27</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CI-CD/" itemprop="url" rel="index"><span itemprop="name">CI&CD</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="1、CI-CD介绍"><a href="#1、CI-CD介绍" class="headerlink" title="1、CI/CD介绍"></a>1、CI/CD介绍</h3><p>CI/CD是一个持续的闭环的流程。</p>
<p><img src="http://static.staryjie.com/static/images/20190626160504.png" alt="CI/CD"></p>
<a id="more"></a>
<h4 id="1-1-什么是CI？"><a href="#1-1-什么是CI？" class="headerlink" title="1.1 什么是CI？"></a>1.1 什么是CI？</h4><p>​        在软件工程中，持续集成（CI）是指将所有开发者的工作副本每天多次合并到主干的做法。Grady Booch 在1991年的 Booch method 中首次命名并提出了 CI 的概念，尽管在当时他并不主张每天多次集成。而 XP（Extreme programming，极限编程）采用了 CI 的概念，并提倡每天不止一次集成。</p>
<h4 id="1-2-什么是CD？"><a href="#1-2-什么是CD？" class="headerlink" title="1.2 什么是CD？"></a>1.2 什么是CD？</h4><p>​        持续交付/持续部署(CD)就是在持续集成的基础上，产品不断的迭代更新，最终能够交付到客户手中或者部署到生成环境。</p>
<h4 id="1-3-CI-CD的优点"><a href="#1-3-CI-CD的优点" class="headerlink" title="1.3 CI/CD的优点"></a>1.3 CI/CD的优点</h4><ol>
<li><p>解放了重复性劳动</p>
<p>自动化部署工作可以解放集成、测试、部署等重复性劳动，而机器集成的频率明显比手工高很多。</p>
</li>
<li><p>更快地修复问题</p>
<p>持续集成更早的获取变更，更早的进入测试，更早的发现问题，解决问题的成本显著下降。</p>
</li>
<li><p>更快的交付成果</p>
<p>更早发现错误减少解决错误所需的工作量。集成服务器在构建环节发现错误可以及时通知开发人员修复。集成服务器在部署环节发现错误可以回退到上一版本，服务器始终有一个可用的版本。</p>
</li>
<li><p>减少手工的错误</p>
<p>在重复性动作上，人容易犯错，而机器犯错的几率几乎为零。</p>
</li>
<li><p>减少了等待时间</p>
<p>缩短了从开发、集成、测试、部署各个环节的时间，从而也就缩短了中间可以出现的等待时机。持续集成，意味着开发、集成、测试、部署也得以持续。</p>
</li>
<li><p>更高的产品质量</p>
<p>集成服务器往往提供代码质量检测等功能，对不规范或有错误的地方会进行标致，也可以设置邮件和短信等进行警告。</p>
</li>
</ol>
<h4 id="1-4-CI-CD最佳实践"><a href="#1-4-CI-CD最佳实践" class="headerlink" title="1.4 CI/CD最佳实践"></a>1.4 CI/CD最佳实践</h4><ol>
<li><p>频繁检出代码</p>
<p>有时候代码冲突无可避免，频繁检出代码，可以让本地的副本和代码库中的版本最小差异化。</p>
</li>
<li><p>频繁提交代码</p>
<p>与频繁检出代码的原理类似，频繁提交代码，可以让其他人检出副本和代码库中的版本最小差异化。</p>
</li>
<li><p>减少分支，回归主干</p>
<p>多个分支并行应及早将变更集成到主干中，避免同时维护软件的多个版本。</p>
</li>
<li><p>使用自动化构建</p>
<p>可以使用Maven、Ant等来实现自动化构建，可以在构建过程中实现自动化测试。前提是有写单元测试用例。</p>
</li>
<li><p>提交测试</p>
<p>在提交工作之前，每个程序员必须本地集成所有代码，做一个完整的构建和运行，并通过所有的单元测试，这样能减少集成测试在集成服务器上构建失败的风险。</p>
</li>
<li><p>当前状态对每个人都可见</p>
<p>集成服务器在持续集成过程中发现问题应及时发送警告给相关的干系人。</p>
</li>
</ol>
<h3 id="2、发布流程设计"><a href="#2、发布流程设计" class="headerlink" title="2、发布流程设计"></a>2、发布流程设计</h3><p><img src="http://static.staryjie.com/static/images/20190627094657.png" alt></p>
<h4 id="2-1-发布流程"><a href="#2-1-发布流程" class="headerlink" title="2.1 发布流程"></a>2.1 发布流程</h4><ol>
<li>开发将代码提交到Git服务器(GitLab/GitHub/SVN等)</li>
<li>Jenkins拉取Git服务器上的代码通过Maven或者Ant构建</li>
<li>docker结合脚本(docker build &amp; docker run)将构建好的代码封装在docker镜像中并推送到Docker镜像仓库</li>
<li>不同的环境的配置文件可以通过配置中心来配置，测试环境拉取对应的镜像和配置文件到测试环境中运行</li>
<li>测试通过后，结合配置中心，拉取镜像和正式环境配置文件，在正式环境中运行</li>
</ol>
<h4 id="2-2-配置中心的必要性"><a href="#2-2-配置中心的必要性" class="headerlink" title="2.2 配置中心的必要性"></a>2.2 配置中心的必要性</h4><p>​        配置中心能够根据不同的环境配置好不同的配置文件，免去了人工替换配置文件的步骤，减少了出错率，大大的提高持续集成、持续部署、持续交付的效率。目前常用的配置中心有<a href="https://github.com/ctripcorp/apollo" target="_blank" rel="noopener">apollo</a>和<a href="https://github.com/knightliao/disconf" target="_blank" rel="noopener">disconf</a>等。</p>
<p>​        配置中心的搭建可以在网上找到各种文档，也可以在参考官方的安装文档。<a href="https://blog.csdn.net/luhong327/article/details/81453001" target="_blank" rel="noopener">apollo安装</a>、<a href="https://www.cnblogs.com/garfieldcgf/p/6439221.html" target="_blank" rel="noopener">disconf安装</a></p>
<h3 id="3、部署Git服务器"><a href="#3、部署Git服务器" class="headerlink" title="3、部署Git服务器"></a>3、部署Git服务器</h3><h4 id="3-1-安装git"><a href="#3-1-安装git" class="headerlink" title="3.1 安装git"></a>3.1 安装git</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure>
<h4 id="3-2-添加git用户并设置密码"><a href="#3-2-添加git用户并设置密码" class="headerlink" title="3.2 添加git用户并设置密码"></a>3.2 添加git用户并设置密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd git</span><br><span class="line">passwd git</span><br></pre></td></tr></table></figure>
<h4 id="3-3-创建项目"><a href="#3-3-创建项目" class="headerlink" title="3.3 创建项目"></a>3.3 创建项目</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.切换到git用户</span><br><span class="line">su - git</span><br><span class="line"><span class="meta">#</span> 2.创建项目</span><br><span class="line">mkdir -p solo.git</span><br><span class="line">cd solo.git/</span><br><span class="line"><span class="meta">#</span> 3.初始化项目</span><br><span class="line">git --bare init</span><br></pre></td></tr></table></figure>
<h4 id="4-4-Jenkins服务器实现免密码交互"><a href="#4-4-Jenkins服务器实现免密码交互" class="headerlink" title="4.4 Jenkins服务器实现免密码交互"></a>4.4 Jenkins服务器实现免密码交互</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.生成私钥</span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="meta">#</span> 2.将公钥发送到Git服务器</span><br><span class="line">ssh-copy-id git@10.0.0.20</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190629160945.png" alt></p>
<p><img src="http://static.staryjie.com/static/images/20190629161138.png" alt></p>
<h3 id="4、部署Harbor镜像仓库"><a href="#4、部署Harbor镜像仓库" class="headerlink" title="4、部署Harbor镜像仓库"></a>4、部署Harbor镜像仓库</h3><h4 id="4-1-部署方式"><a href="#4-1-部署方式" class="headerlink" title="4.1 部署方式"></a>4.1 部署方式</h4><ol>
<li>在线安装</li>
<li>离线安装</li>
<li>OVA程序安装</li>
</ol>
<h4 id="4-2-离线安装"><a href="#4-2-离线安装" class="headerlink" title="4.2 离线安装"></a>4.2 离线安装</h4><h5 id="4-2-1-安装docker和docker-compose"><a href="#4-2-1-安装docker和docker-compose" class="headerlink" title="4.2.1 安装docker和docker-compose"></a>4.2.1 安装docker和docker-compose</h5><p>​        因为Harbor离线安装方式是基于docker-compose编排安装的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.获取docker-compose</span><br><span class="line">sudo curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span> 2.给予可执行权限</span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span> 3.加入环境变量，有多种方式，个人认为下面的方式最简单有效</span><br><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line"><span class="meta">#</span> 4.检查</span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>
<h5 id="4-2-2-下载Harbor离线安装包"><a href="#4-2-2-下载Harbor离线安装包" class="headerlink" title="4.2.2 下载Harbor离线安装包"></a>4.2.2 下载Harbor离线安装包</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> Harbor下载地址https://github.com/goharbor/harbor/releases</span><br><span class="line">cd /opt &amp;&amp; wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.0.tgz</span><br></pre></td></tr></table></figure>
<h5 id="4-2-3-安装Harbor"><a href="#4-2-3-安装Harbor" class="headerlink" title="4.2.3 安装Harbor"></a>4.2.3 安装Harbor</h5><h6 id="4-2-3-1-解压安装包"><a href="#4-2-3-1-解压安装包" class="headerlink" title="4.2.3.1 解压安装包"></a>4.2.3.1 解压安装包</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.解压安装包</span><br><span class="line">tar xf harbor-offline-installer-v1.8.0.tar</span><br></pre></td></tr></table></figure>
<h6 id="4-2-3-2-修改配置文件"><a href="#4-2-3-2-修改配置文件" class="headerlink" title="4.2.3.2 修改配置文件"></a>4.2.3.2 修改配置文件</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/harbor/harbor.yml</span><br><span class="line"></span><br><span class="line">hostname: harbor.biu2ful.xyz</span><br><span class="line">https:</span><br><span class="line">   port: 443</span><br><span class="line">   certificate: /etc/docker/certs.d/harbor.biu2ful.xyz/ca.crt</span><br><span class="line">   private_key: /etc/docker/certs.d/harbor.biu2ful.xyz/ca.key</span><br><span class="line">harbor_admin_password: Harbor123456</span><br><span class="line">database:</span><br><span class="line">  password: root123</span><br><span class="line">data_volume: /data</span><br><span class="line">clair:</span><br><span class="line">  updaters_interval: 12</span><br><span class="line">  http_proxy:</span><br><span class="line">  https_proxy:</span><br><span class="line">  no_proxy: 127.0.0.1,localhost,core,registry</span><br><span class="line">jobservice:</span><br><span class="line">  max_job_workers: 10</span><br><span class="line">chart:</span><br><span class="line">  absolute_url: disabled</span><br><span class="line">log:</span><br><span class="line">  level: info</span><br><span class="line">  rotate_count: 50</span><br><span class="line">  rotate_size: 200M</span><br><span class="line">  location: /var/log/harbor</span><br><span class="line">_version: 1.8.0</span><br></pre></td></tr></table></figure>
<p>​        精简后的配置文件如下图：</p>
<p><img src="http://static.staryjie.com/static/images/20190630212517.png" alt></p>
<h6 id="4-2-3-3-生成对应的签名证书文件"><a href="#4-2-3-3-生成对应的签名证书文件" class="headerlink" title="4.2.3.3 生成对应的签名证书文件"></a>4.2.3.3 生成对应的签名证书文件</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.创建证书存放路径</span><br><span class="line">mkdir -p /etc/docker/certs.d/harbor.biu2ful.xyz/</span><br><span class="line"><span class="meta">#</span> 2.生成自签名证书key文件</span><br><span class="line">openssl genrsa -out /etc/docker/certs.d/harbor.biu2ful.xyz/ca.key 2048</span><br><span class="line"><span class="meta">#</span> 3.生成自签名证书crt文件</span><br><span class="line">openssl req -x509 -new -nodes -key /etc/docker/certs.d/harbor.biu2ful.xyz/ca.key -subj "/CN=harbor.biu2ful.xyz" -days 100000 -out /etc/docker/certs.d/harbor.biu2ful.xyz/ca.crt</span><br></pre></td></tr></table></figure>
<h6 id="4-2-3-4-配置Harbor"><a href="#4-2-3-4-配置Harbor" class="headerlink" title="4.2.3.4 配置Harbor"></a>4.2.3.4 配置Harbor</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/harbor/ &amp;&amp; ./prepare</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630215243.png" alt></p>
<h6 id="4-2-3-4-安装Harbor"><a href="#4-2-3-4-安装Harbor" class="headerlink" title="4.2.3.4 安装Harbor"></a>4.2.3.4 安装Harbor</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630215318.png" alt></p>
<p><img src="http://static.staryjie.com/static/images/20190630215331.png" alt></p>
<h4 id="4-3-客户端配置"><a href="#4-3-客户端配置" class="headerlink" title="4.3 客户端配置"></a>4.3 客户端配置</h4><h5 id="4-3-1-创建证书存放路径"><a href="#4-3-1-创建证书存放路径" class="headerlink" title="4.3.1 创建证书存放路径"></a>4.3.1 创建证书存放路径</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker/certs.d/harbor.biu2ful.xyz/</span><br></pre></td></tr></table></figure>
<h5 id="4-3-2-获取自签名证书crt文件"><a href="#4-3-2-获取自签名证书crt文件" class="headerlink" title="4.3.2 获取自签名证书crt文件"></a>4.3.2 获取自签名证书crt文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 从Harbor所在服务器scp证书文件到docker客户端，其中10.0.0.30是docker客户端的地址，根据自己的对应修改。</span><br><span class="line">scp ca.crt root@10.0.0.30:/etc/docker/certs.d/harbor.biu2ful.xyz/</span><br></pre></td></tr></table></figure>
<h5 id="4-3-3-重启docker服务"><a href="#4-3-3-重启docker服务" class="headerlink" title="4.3.3 重启docker服务"></a>4.3.3 重启docker服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker.service</span><br></pre></td></tr></table></figure>
<h4 id="4-4-测试是否能够正常使用"><a href="#4-4-测试是否能够正常使用" class="headerlink" title="4.4 测试是否能够正常使用"></a>4.4 测试是否能够正常使用</h4><h5 id="4-4-1浏览器访问"><a href="#4-4-1浏览器访问" class="headerlink" title="4.4.1浏览器访问"></a>4.4.1浏览器访问</h5><p>​        访问：<a href="https://harbor.biu2ful.xyz/" target="_blank" rel="noopener">https://harbor.biu2ful.xyz/</a></p>
<p><img src="http://static.staryjie.com/static/images/20190630215555.png" alt></p>
<h5 id="4-4-2-docker客户端登陆"><a href="#4-4-2-docker客户端登陆" class="headerlink" title="4.4.2 docker客户端登陆"></a>4.4.2 docker客户端登陆</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login harbor.biu2ful.xyz</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630215733.png" alt></p>
<h5 id="4-4-3-推送和拉取镜像"><a href="#4-4-3-推送和拉取镜像" class="headerlink" title="4.4.3 推送和拉取镜像"></a>4.4.3 推送和拉取镜像</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 推送镜像到Harbor仓库</span><br><span class="line">docker tag mysql:5.6 harbor.biu2ful.xyz/library/mysql:5.6</span><br><span class="line">docker push harbor.biu2ful.xyz/library/mysql:5.6</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630215828.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 从Harbor仓库拉取镜像</span><br><span class="line">docker image rm harbor.biu2ful.xyz/library/mysql:5.6</span><br><span class="line">docker pull harbor.biu2ful.xyz/library/mysql:5.6</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630215855.png" alt></p>
<h3 id="5、构建业务基础镜像"><a href="#5、构建业务基础镜像" class="headerlink" title="5、构建业务基础镜像"></a>5、构建业务基础镜像</h3><h4 id="5-1-编写Dockerfile"><a href="#5-1-编写Dockerfile" class="headerlink" title="5.1 编写Dockerfile"></a>5.1 编写Dockerfile</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER staryjie@gmail.com</span><br><span class="line"></span><br><span class="line">RUN yum install unzip iproute -y</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_141/</span><br><span class="line">ADD apache-tomcat-8.0.46.tar.gz /usr/local</span><br><span class="line">RUN mv /usr/local/apache-tomcat-8.0.46.tar.gz /usr/local/tomcat</span><br><span class="line">WORKDIR /usr/local/tomcat</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT [&quot;./bin/catalina.sh&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>
<h4 id="5-2-通过Dockerfile构建镜像"><a href="#5-2-通过Dockerfile构建镜像" class="headerlink" title="5.2 通过Dockerfile构建镜像"></a>5.2 通过Dockerfile构建镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t tomcat:v1 .</span><br></pre></td></tr></table></figure>
<h4 id="5-3-将镜像推送到Harbor仓库"><a href="#5-3-将镜像推送到Harbor仓库" class="headerlink" title="5.3 将镜像推送到Harbor仓库"></a>5.3 将镜像推送到Harbor仓库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag tomcat:v1 harbor.biu2ful.xyz/test/tomcat:v</span><br><span class="line">docker push harbor.biu2ful.xyz/test/tomcat:v1</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190629163516.png" alt></p>
<h3 id="6、测试服务器安装Docker"><a href="#6、测试服务器安装Docker" class="headerlink" title="6、测试服务器安装Docker"></a>6、测试服务器安装Docker</h3><h4 id="6-1-安装依赖"><a href="#6-1-安装依赖" class="headerlink" title="6.1 安装依赖"></a>6.1 安装依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 chrony</span><br></pre></td></tr></table></figure>
<h5 id="6-2-添加阿里云的docker仓库"><a href="#6-2-添加阿里云的docker仓库" class="headerlink" title="6.2 添加阿里云的docker仓库"></a>6.2 添加阿里云的docker仓库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<h5 id="6-3-安装docker"><a href="#6-3-安装docker" class="headerlink" title="6.3 安装docker"></a>6.3 安装docker</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>
<h5 id="6-4-启动并设置开机自启"><a href="#6-4-启动并设置开机自启" class="headerlink" title="6.4 启动并设置开机自启"></a>6.4 启动并设置开机自启</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker.service</span><br><span class="line">systemctl enable docker.service</span><br></pre></td></tr></table></figure>
<h5 id="6-5-配置daocloud加速"><a href="#6-5-配置daocloud加速" class="headerlink" title="6.5 配置daocloud加速"></a>6.5 配置daocloud加速</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker.service</span><br><span class="line">systemctl enable docker.service</span><br><span class="line">systemctl start chronyd.service</span><br><span class="line">systemctl enable chronyd.service</span><br></pre></td></tr></table></figure>
<h5 id="6-6-重启docker服务"><a href="#6-6-重启docker服务" class="headerlink" title="6.6 重启docker服务"></a>6.6 重启docker服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h5 id="6-7-检查是否正常安装docker"><a href="#6-7-检查是否正常安装docker" class="headerlink" title="6.7 检查是否正常安装docker"></a>6.7 检查是否正常安装docker</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 下面是一个很简单的安装脚本：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 1.安装依赖</span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 chrony</span><br><span class="line"><span class="meta">#</span> 2.添加阿里云的docker仓库</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span> 3.安装docker</span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span> 4.启动并设置开机自启</span><br><span class="line">systemctl start docker.service</span><br><span class="line">systemctl enable docker.service</span><br><span class="line"><span class="meta">#</span> 5. 配置daocloud加速</span><br><span class="line">curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io</span><br><span class="line"><span class="meta">#</span> 6.重启docker服务</span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="meta">#</span> 7.检查是否正常安装docker</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="7、Jenkins安装"><a href="#7、Jenkins安装" class="headerlink" title="7、Jenkins安装"></a>7、Jenkins安装</h3><h4 id="7-1-构建jenkins镜像"><a href="#7-1-构建jenkins镜像" class="headerlink" title="7.1 构建jenkins镜像"></a>7.1 构建jenkins镜像</h4><p>​        编写Dockerfile：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM jenkins/jenkins</span><br><span class="line">USER root</span><br><span class="line">RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak &amp;&amp; wget http://static.staryjie.com/sources.list -O /etc/apt/sources.list</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y git libltdl-dev</span><br></pre></td></tr></table></figure>
<p>​        通过Dockerfile构建镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t jenkins:v1 .</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在安装的时候发现版本太低的Jenkins很多插件都装不上，建议使用最新版本的Jenkins。</p>
<p><a href="https://www.cnblogs.com/sxdcgaq8080/p/10489326.html" target="_blank" rel="noopener">https://www.cnblogs.com/sxdcgaq8080/p/10489326.html</a></p>
</blockquote>
<h4 id="7-2-通过镜像启动容器"><a href="#7-2-通过镜像启动容器" class="headerlink" title="7.2 通过镜像启动容器"></a>7.2 通过镜像启动容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name jenkins \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">-p 50000:50000 \</span><br><span class="line"><span class="meta">#</span> jenkins目录</span><br><span class="line">-v /var/jenkins_home/:/var/jenkins_home \</span><br><span class="line"><span class="meta">#</span> 挂载宿主机maven到jenkins容器</span><br><span class="line">-v /usr/local/maven3.6/:/usr/local/maven \</span><br><span class="line"><span class="meta">#</span> 挂载宿主机jdk到jenkins容器</span><br><span class="line">-v /usr/local/jdk1.8.0_141/:/usr/local/jdk \</span><br><span class="line"><span class="meta">#</span> 挂载宿主机docker到jenkins容器</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line"><span class="meta">#</span> 将docker相关命令挂载到jenkins容器</span><br><span class="line">-v $(which docker):/usr/bin/docker \</span><br><span class="line"><span class="meta">#</span> 挂载sshkey，实现免密码</span><br><span class="line">-v ~/.ssh:/root/.ssh \</span><br><span class="line">jenkins:v1</span><br><span class="line"><span class="meta">#</span> registry.cn-hangzhou.aliyuncs.com/harbor-aliyun/jenkins:v1</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190629160309.png" alt></p>
<h4 id="7-3-浏览器访问http-ip-8080"><a href="#7-3-浏览器访问http-ip-8080" class="headerlink" title="7.3 浏览器访问http://ip:8080"></a>7.3 浏览器访问<a href="http://ip:8080" target="_blank" rel="noopener">http://ip:8080</a></h4><p><img src="http://static.staryjie.com/static/images/20190629160423.png" alt></p>
<h4 id="7-4-自定义安装Jenkins插件"><a href="#7-4-自定义安装Jenkins插件" class="headerlink" title="7.4 自定义安装Jenkins插件"></a>7.4 自定义安装Jenkins插件</h4><p><img src="http://static.staryjie.com/static/images/20190629161631.png" alt></p>
<p><img src="http://static.staryjie.com/static/images/20190629161741.png" alt></p>
<h4 id="7-5-创建管理员账号"><a href="#7-5-创建管理员账号" class="headerlink" title="7.5 创建管理员账号"></a>7.5 创建管理员账号</h4><p><img src="http://static.staryjie.com/static/images/20190630124544.png" alt></p>
<h3 id="8、Jenkins基本配置"><a href="#8、Jenkins基本配置" class="headerlink" title="8、Jenkins基本配置"></a>8、Jenkins基本配置</h3><h4 id="8-1-配置Jenkins的URL"><a href="#8-1-配置Jenkins的URL" class="headerlink" title="8.1 配置Jenkins的URL"></a>8.1 配置Jenkins的URL</h4><p>​        根据自己的实际情况设置，可以直接是ip+端口，或者域名通过nginx或者其他web中间件代理。</p>
<p><img src="http://static.staryjie.com/static/images/20190630124656.png" alt></p>
<h4 id="8-2-开始使用Jenkins"><a href="#8-2-开始使用Jenkins" class="headerlink" title="8.2 开始使用Jenkins"></a>8.2 开始使用Jenkins</h4><p><img src="http://static.staryjie.com/static/images/20190630125049.png" alt></p>
<p>开始使用Jenkins之后进到Jenkins的首页：</p>
<p><img src="http://static.staryjie.com/static/images/20190630125137.png" alt></p>
<h4 id="8-3-系统管理-全局配置"><a href="#8-3-系统管理-全局配置" class="headerlink" title="8.3 系统管理-全局配置"></a>8.3 系统管理-全局配置</h4><h5 id="8-3-1-配置JDK"><a href="#8-3-1-配置JDK" class="headerlink" title="8.3.1 配置JDK"></a>8.3.1 配置JDK</h5><p>​        在启动jenkins容器的时候我们将宿主机的jdk挂载到了容器中，所以不需要勾选自动安装，只需要将启动时候指定的路径填写好即可：</p>
<p><img src="http://static.staryjie.com/static/images/20190630125555.png" alt></p>
<h5 id="8-3-2-配置git"><a href="#8-3-2-配置git" class="headerlink" title="8.3.2 配置git"></a>8.3.2 配置git</h5><p>​        git是通过yum安装的，所以配置直接使用默认的就可以：</p>
<p><img src="http://static.staryjie.com/static/images/20190630125837.png" alt></p>
<h5 id="8-3-3-配置Maven"><a href="#8-3-3-配置Maven" class="headerlink" title="8.3.3 配置Maven"></a>8.3.3 配置Maven</h5><p>​        和jdk配置一样，在启动jenkins容器的时候就已经将宿主机的Maven挂载在容器中了，所以只要配置好路径即可：</p>
<p><img src="http://static.staryjie.com/static/images/20190630130047.png" alt></p>
<h4 id="8-4-系统管理-系统配置"><a href="#8-4-系统管理-系统配置" class="headerlink" title="8.4 系统管理-系统配置"></a>8.4 系统管理-系统配置</h4><h5 id="8-4-1-SSH-remote-hosts配置"><a href="#8-4-1-SSH-remote-hosts配置" class="headerlink" title="8.4.1 SSH remote hosts配置"></a>8.4.1 SSH remote hosts配置</h5><p>​        增加一个Jenkins要访问的docker主机的ip，为了实现免密码交互，将Jenkins主机的公钥发送到docker主机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id root@10.0.0.30</span><br></pre></td></tr></table></figure>
<p>​        在Jenkins中添加凭据：</p>
<p><img src="http://static.staryjie.com/static/images/20190630131002.png" alt></p>
<p>​        在系统配置中添加SSH remote hosts配置：</p>
<p><img src="http://static.staryjie.com/static/images/20190630131541.png" alt></p>
<h3 id="9、Jenkins创建项目"><a href="#9、Jenkins创建项目" class="headerlink" title="9、Jenkins创建项目"></a>9、Jenkins创建项目</h3><h4 id="9-1-创建项目"><a href="#9-1-创建项目" class="headerlink" title="9.1 创建项目"></a>9.1 创建项目</h4><p>​        在首页有一个创建新任务的选项。</p>
<p><img src="http://static.staryjie.com/static/images/20190630131704.png" alt></p>
<p>​        创建一个Maven的项目：</p>
<p><img src="http://static.staryjie.com/static/images/20190630131803.png" alt></p>
<h4 id="9-2-项目配置"><a href="#9-2-项目配置" class="headerlink" title="9.2 项目配置"></a>9.2 项目配置</h4><h5 id="9-2-1-源码管理"><a href="#9-2-1-源码管理" class="headerlink" title="9.2.1 源码管理"></a>9.2.1 源码管理</h5><p>​        在源码管理选项中选择自己的源码管理方式和源码拉取地址：</p>
<p><img src="http://static.staryjie.com/static/images/20190630132104.png" alt></p>
<h5 id="9-2-2-Maven构建前-配置Maven跳过项目测试用例"><a href="#9-2-2-Maven构建前-配置Maven跳过项目测试用例" class="headerlink" title="9.2.2 Maven构建前-配置Maven跳过项目测试用例"></a>9.2.2 Maven构建前-配置Maven跳过项目测试用例</h5><p>​        参数是：clean package -Dmaven.test.skip=true</p>
<p><img src="http://static.staryjie.com/static/images/20190630132326.png" alt></p>
<h5 id="9-2-3-Maven构建后配置"><a href="#9-2-3-Maven构建后配置" class="headerlink" title="9.2.3 Maven构建后配置"></a>9.2.3 Maven构建后配置</h5><p>​        通过构建后配置将war包基于基础业务镜像进行构建新的镜像，并上传到Harbor镜像仓库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd $WORKSPACE</span><br><span class="line">docker login -u admin -p Harbor123456 harbor.biu2ful.xyz</span><br><span class="line">cat &gt; Dockerfile &lt;&lt; EOF</span><br><span class="line">FROM harbor.biu2ful.xyz/test/tomcat:v1</span><br><span class="line">MAINTAINER staryjie@gmail.com</span><br><span class="line"></span><br><span class="line">COPY target/solo.war /tmp/ROOT.war</span><br><span class="line">RUN rm -rf /usr/local/tomcat/webapps/* &amp;&amp;  \</span><br><span class="line">         unzip /tmp/ROOT.war -d /usr/local/tomcat/webapps/ROOT &amp;&amp; \</span><br><span class="line">         rm -f /tmp/ROOT.war</span><br><span class="line">ENTRYPOINT ["./bin/catalina.sh", "run"]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">docker build -t harbor.biu2ful.xyz/test/solo:v1 .</span><br><span class="line">docker push harbor.biu2ful.xyz/test/solo:v1</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630143110.png" alt></p>
<h5 id="9-2-4-构建完成后在远程主机上执行命令"><a href="#9-2-4-构建完成后在远程主机上执行命令" class="headerlink" title="9.2.4 构建完成后在远程主机上执行命令"></a>9.2.4 构建完成后在远程主机上执行命令</h5><p>​        上一步将新构建的镜像推送到Harbor仓库，这一步通过仓库的镜像在远程主机上启动一个容器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BUILD_ID=DONTKILLME</span><br><span class="line">docker login -uadmin -pHarbor123456 harbor.biu2ful.xyz</span><br><span class="line">docker rm -f solo|true</span><br><span class="line">docker image rm -f harbor.biu2ful.xyz/test/solo:v1|true</span><br><span class="line">docker run -d --name solo -p 8888:8080 -v /usr/local/jdk1.8.0_141/:/usr/local/jdk1.8.0_141/ harbor.biu2ful.xyz/test/solo:v1</span><br></pre></td></tr></table></figure>
<p><img src="http://static.staryjie.com/static/images/20190630144948.png" alt></p>
<h3 id="10、测试"><a href="#10、测试" class="headerlink" title="10、测试"></a>10、测试</h3><h4 id="10-1-将项目代码推送到Git服务器"><a href="#10-1-将项目代码推送到Git服务器" class="headerlink" title="10.1 将项目代码推送到Git服务器"></a>10.1 将项目代码推送到Git服务器</h4><p>​        这里通过一个GitHub上java的开源博客系统来测试。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.将Git服务器新建的仓库clone到本地</span><br><span class="line">cd /root/cicd &amp;&amp; git clone root@10.0.0.20:/home/git/solo.git</span><br><span class="line"><span class="meta">#</span> 2.获取代码</span><br><span class="line">git clone https://github.com/b3log/solo.git</span><br><span class="line"><span class="meta">#</span> 3.将GitHub上clone的代码复制到从Git仓库clone的空仓库里面</span><br><span class="line">cp ./solo-master/* ./solo/ -rf</span><br><span class="line"><span class="meta">#</span> 4.将代码通过git提交到Git服务器创建好的仓库</span><br><span class="line">git config --global user.email "staryjie@163.com"</span><br><span class="line">git config --global user.name "staryjie"</span><br><span class="line">git add .</span><br><span class="line">git commit -m "all"</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<h4 id="10-2-Jenkins构建"><a href="#10-2-Jenkins构建" class="headerlink" title="10.2 Jenkins构建"></a>10.2 Jenkins构建</h4><h5 id="10-2-1-构建项目"><a href="#10-2-1-构建项目" class="headerlink" title="10.2.1 构建项目"></a>10.2.1 构建项目</h5><p>​        通过上面已经创建的Maven项目solo_blog来构建：</p>
<p><img src="http://static.staryjie.com/static/images/20190630133041.png" alt></p>
<h5 id="10-2-3-查看控制台输出"><a href="#10-2-3-查看控制台输出" class="headerlink" title="10.2.3 查看控制台输出"></a>10.2.3 查看控制台输出</h5><p>​        点击立即构建之后就可以点击查看控制台输出来查看整个构建过程:</p>
<p><img src="http://static.staryjie.com/static/images/20190630133217.png" alt></p>
<p>​        第一次构建需要花费的时间比较多，耐心等待一会儿就可以看到构建结果：</p>
<p><img src="http://static.staryjie.com/static/images/20190630134051.png" alt></p>
<p>​        在服务器上查看构建好的war包：</p>
<p><img src="http://static.staryjie.com/static/images/20190630134258.png" alt></p>
<p>​        添加构建后将war包和基础镜像构建新镜像并推送到Harbor仓库的配置后，再次构建：</p>
<p><img src="http://static.staryjie.com/static/images/20190630143336.png" alt></p>
<p>​        在Harbor仓库查看镜像：</p>
<p><img src="http://static.staryjie.com/static/images/20190630143506.png" alt></p>
<p>​        配置了远程主机拉取镜像并运行容器之后，查看Jenkins执行结果：</p>
<p><img src="http://static.staryjie.com/static/images/20190630211739.png" alt></p>
<p>​        在远程主机查看是否有对应的镜像和已经运行的叫solo的容器：</p>
<p><img src="http://static.staryjie.com/static/images/20190630211617.png" alt></p>
<p><img src="http://static.staryjie.com/static/images/20190630213434.png" alt></p>
<p>​        在浏览器上访问：<a href="http://10.0.0.30:8888" target="_blank" rel="noopener">http://10.0.0.30:8888</a></p>
<p><img src="http://static.staryjie.com/static/images/20190630211855.png" alt></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Docker/" rel="tag"># Docker</a>
            
              <a href="/tags/CI-CD/" rel="tag"># CI&CD</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/09/27/通过阿里云Python-SDK管理ECS安全组/" rel="next" title="通过阿里云Python SDK管理ECS安全组">
                  <i class="fa fa-chevron-left"></i> 通过阿里云Python SDK管理ECS安全组
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/09/27/Jenkins-GitLab-Ansible-playbook的环境安装-yum/" rel="prev" title="Jenkins+GitLab+Ansible-playbook的环境安装(yum)">
                  Jenkins+GitLab+Ansible-playbook的环境安装(yum) <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、CI-CD介绍"><span class="nav-number">1.</span> <span class="nav-text">1、CI/CD介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-什么是CI？"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 什么是CI？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-什么是CD？"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 什么是CD？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-CI-CD的优点"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 CI/CD的优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-CI-CD最佳实践"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 CI/CD最佳实践</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、发布流程设计"><span class="nav-number">2.</span> <span class="nav-text">2、发布流程设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-发布流程"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 发布流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-配置中心的必要性"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 配置中心的必要性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3、部署Git服务器"><span class="nav-number">3.</span> <span class="nav-text">3、部署Git服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-安装git"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 安装git</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-添加git用户并设置密码"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 添加git用户并设置密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-创建项目"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-Jenkins服务器实现免密码交互"><span class="nav-number">3.4.</span> <span class="nav-text">4.4 Jenkins服务器实现免密码交互</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4、部署Harbor镜像仓库"><span class="nav-number">4.</span> <span class="nav-text">4、部署Harbor镜像仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-部署方式"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 部署方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-离线安装"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 离线安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-安装docker和docker-compose"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 安装docker和docker-compose</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-下载Harbor离线安装包"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 下载Harbor离线安装包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-3-安装Harbor"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 安装Harbor</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-3-1-解压安装包"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">4.2.3.1 解压安装包</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-3-2-修改配置文件"><span class="nav-number">4.2.3.2.</span> <span class="nav-text">4.2.3.2 修改配置文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-3-3-生成对应的签名证书文件"><span class="nav-number">4.2.3.3.</span> <span class="nav-text">4.2.3.3 生成对应的签名证书文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-3-4-配置Harbor"><span class="nav-number">4.2.3.4.</span> <span class="nav-text">4.2.3.4 配置Harbor</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-2-3-4-安装Harbor"><span class="nav-number">4.2.3.5.</span> <span class="nav-text">4.2.3.4 安装Harbor</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-客户端配置"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 客户端配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-1-创建证书存放路径"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1 创建证书存放路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-2-获取自签名证书crt文件"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2 获取自签名证书crt文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-3-重启docker服务"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3.3 重启docker服务</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-测试是否能够正常使用"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 测试是否能够正常使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-1浏览器访问"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.4.1浏览器访问</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-2-docker客户端登陆"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.4.2 docker客户端登陆</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-3-推送和拉取镜像"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.4.3 推送和拉取镜像</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、构建业务基础镜像"><span class="nav-number">5.</span> <span class="nav-text">5、构建业务基础镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-编写Dockerfile"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 编写Dockerfile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-通过Dockerfile构建镜像"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 通过Dockerfile构建镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-将镜像推送到Harbor仓库"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 将镜像推送到Harbor仓库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6、测试服务器安装Docker"><span class="nav-number">6.</span> <span class="nav-text">6、测试服务器安装Docker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-安装依赖"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 安装依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-添加阿里云的docker仓库"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.2 添加阿里云的docker仓库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-3-安装docker"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.3 安装docker</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-4-启动并设置开机自启"><span class="nav-number">6.1.3.</span> <span class="nav-text">6.4 启动并设置开机自启</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-5-配置daocloud加速"><span class="nav-number">6.1.4.</span> <span class="nav-text">6.5 配置daocloud加速</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-6-重启docker服务"><span class="nav-number">6.1.5.</span> <span class="nav-text">6.6 重启docker服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-7-检查是否正常安装docker"><span class="nav-number">6.1.6.</span> <span class="nav-text">6.7 检查是否正常安装docker</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7、Jenkins安装"><span class="nav-number">7.</span> <span class="nav-text">7、Jenkins安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-构建jenkins镜像"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 构建jenkins镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-通过镜像启动容器"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 通过镜像启动容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-浏览器访问http-ip-8080"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 浏览器访问http://ip:8080</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-自定义安装Jenkins插件"><span class="nav-number">7.4.</span> <span class="nav-text">7.4 自定义安装Jenkins插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5-创建管理员账号"><span class="nav-number">7.5.</span> <span class="nav-text">7.5 创建管理员账号</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8、Jenkins基本配置"><span class="nav-number">8.</span> <span class="nav-text">8、Jenkins基本配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-配置Jenkins的URL"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 配置Jenkins的URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-开始使用Jenkins"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 开始使用Jenkins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-系统管理-全局配置"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 系统管理-全局配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-1-配置JDK"><span class="nav-number">8.3.1.</span> <span class="nav-text">8.3.1 配置JDK</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-2-配置git"><span class="nav-number">8.3.2.</span> <span class="nav-text">8.3.2 配置git</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-3-配置Maven"><span class="nav-number">8.3.3.</span> <span class="nav-text">8.3.3 配置Maven</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-系统管理-系统配置"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 系统管理-系统配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-4-1-SSH-remote-hosts配置"><span class="nav-number">8.4.1.</span> <span class="nav-text">8.4.1 SSH remote hosts配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9、Jenkins创建项目"><span class="nav-number">9.</span> <span class="nav-text">9、Jenkins创建项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-创建项目"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-项目配置"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 项目配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-1-源码管理"><span class="nav-number">9.2.1.</span> <span class="nav-text">9.2.1 源码管理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-2-Maven构建前-配置Maven跳过项目测试用例"><span class="nav-number">9.2.2.</span> <span class="nav-text">9.2.2 Maven构建前-配置Maven跳过项目测试用例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-3-Maven构建后配置"><span class="nav-number">9.2.3.</span> <span class="nav-text">9.2.3 Maven构建后配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-4-构建完成后在远程主机上执行命令"><span class="nav-number">9.2.4.</span> <span class="nav-text">9.2.4 构建完成后在远程主机上执行命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10、测试"><span class="nav-number">10.</span> <span class="nav-text">10、测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-将项目代码推送到Git服务器"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 将项目代码推送到Git服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-Jenkins构建"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 Jenkins构建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#10-2-1-构建项目"><span class="nav-number">10.2.1.</span> <span class="nav-text">10.2.1 构建项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-2-3-查看控制台输出"><span class="nav-number">10.2.2.</span> <span class="nav-text">10.2.3 查看控制台输出</span></a></li></ol></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="StaryJie">
  <p class="site-author-name" itemprop="name">StaryJie</p>
  <div class="site-description" itemprop="description">记录学习、工作和生活中遇到的各种问题。</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">StaryJie</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="/lib/pjax/pjax.min.js?v=0.2.8"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script><script src="/js/bookmark.js?v=7.4.0"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var id = element.id || '';
    var src = element.src || '';
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (id !=='') {
      script.id = element.id;
    }
    if (src !== '') {
      script.src = src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  








  <script src="/js/local-search.js?v=7.4.0"></script>













    <div id="pjax">

  

  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'cb34a61011c438548cec',
      clientSecret: '3d9c756a081ce2b91a6a286eb1a0a02a71ced6ca',
      repo: '59devops.github.io',
      owner: '59devops',
      admin: ['59devops'],
      id: 'd1008493e96157d793539041870a1f6a',
        language: 'zh-CN',
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

    </div>
</body>
</html>
